---
permalink: copy-based/concept_how_you_transition_volumes_in_a_snapmirror_relationship.html 
sidebar: sidebar 
keywords: ontap, copy, based, transition, snapmirror, transition, volumes, relationship 
summary: SnapMirror 関係にある 7-Mode ボリュームを移行する場合は、最初にセカンダリボリュームを移行する必要があります。その後、 7-Mode プライマリボリュームと ONTAP セカンダリボリュームの間に Volume SnapMirror 関係が確立されます。 
---
= SnapMirror 関係にあるボリュームの移行方法
:icons: font
:imagesdir: ../media/


[role="lead"]
SnapMirror 関係にある 7-Mode ボリュームを移行する場合は、最初にセカンダリボリュームを移行する必要があります。その後、 7-Mode プライマリボリュームと ONTAP セカンダリボリュームの間に Volume SnapMirror 関係が確立されます。

プライマリボリュームが移行されたあとに、 ONTAP のプライマリボリュームとセカンダリボリュームの間に Volume SnapMirror 関係が確立されます。


NOTE: 7-Mode Transition Tool では、 SnapMirror 関係にある SnapLock Compliance ボリュームは自動的に移行されません。SnapMirror 関係にある SnapLock Compliance ボリュームは、すべてスタンドアロンボリュームとして移行する必要があります。プライマリとセカンダリの SnapLock Compliance ボリュームを ONTAP に移行したら、それらのボリューム間で SnapMirror 再同期処理を手動で実行する必要があります。

事前確認、ベースラインコピー、差分転送、および構成の適用（カットオーバー前）は、セカンダリプロジェクトとプライマリプロジェクトで同時に実行できますが、ストレージカットオーバーは先にセカンダリプロジェクトで実行する必要があります。



== 準備フェーズ

このフェーズでは、 7-Mode のシステム、クラスタ、ボリューム、および IP アドレスが選択されます。7-Mode Transition Tool がこのフェーズで実行するタスクは次のとおりです。

. 7-Mode ストレージシステムおよびボリュームの情報を追加します
. 7-Mode ソースボリュームと SnapMirror 関係に関する情報を収集します。
+
** セカンダリボリュームを移行するために、 7-Mode プライマリシステムに関する情報を収集
** プライマリボリュームを移行するために、 7-Mode セカンダリシステムに関する情報を収集


. 移行の事前確認を実行します
. クラスタ、 SVM 、およびアグリゲートの情報を追加します
. SVM に設定する必要がある IP アドレスを収集します。
+
** 7-Mode システムに存在する IP アドレスを選択しています
** で設定する必要がある新しい IP アドレスを指定します SVM
+

NOTE: iSCSI LIF と FC LIF （ SAN ）の移行は、ツールではサポートされていません。移行の前に、 SVM に SAN LIF を手動で設定する必要があります。



. ベースライン転送と差分転送のデータコピースケジュールを作成します。
. プロジェクトに SnapLock ボリュームが含まれている場合は、 CoC 検証を必要とする読み書き可能な SnapLock ボリュームに関する情報、および CoC 検証処理で生成されるフィンガープリントデータを格納する ONTAP ボリュームの詳細情報を収集します。
+

NOTE: SnapLock の CoC 検証は、読み書き可能な 7-Mode SnapLock ボリュームでのみサポートされます。読み取り専用ボリュームではサポートされません。また、名前に非 ASCII 文字を含むファイルが格納されている SnapLock ボリュームでもサポートされません。 SnapLock

. ターゲット SVM およびターゲットボリュームに移行する必要がある 7-Mode 構成を選択して、構成の移行を計画します。


事前確認で報告されたエラーと警告を修正したあとに、コントローラ上のオブジェクト（ボリューム、 IP アドレス、システム情報など）を変更しないでください。



== データコピーフェーズ

このフェーズでは、 7-Mode ボリュームのデータが ONTAP ボリュームにコピーされます。7-Mode Transition Tool がこのフェーズで実行するタスクは次のとおりです。

. 読み取り専用アクセスが可能な ONTAP ボリュームを作成します
. 7-Mode システム間に移行ピア関係を設定します 指定します
. 7-Mode ボリュームと ONTAP の間に SnapMirror 関係を確立します 個のボリューム
. スケジュール設定に基づいてベースラインデータ転送を実行します
. スケジュールされた SnapMirror データコピー更新を ONTAP ボリュームに対して実行します




== 構成の適用（カットオーバー前）フェーズ

計画したカットオーバー期間の数日 ~ 数週間前に構成の適用を実行することを推奨します。この事前確認では、すべての構成が適切に適用されるかどうか、何らかの変更が必要かどうかを検証するための十分な時間が確保されます。

このフェーズでは、 7-Mode ボリュームの構成が ONTAP ボリュームにコピーされます。

構成の適用（カットオーバー前）フェーズには、カットオーバー前読み取り専用モードとカットオーバー前読み取り / 書き込みモードの 2 つのモードがあります。

プロジェクトに次の要素が含まれている場合、カットオーバー前読み取り / 書き込みモードはサポートされません。

* SAN ボリュームとターゲットクラスタで Data ONTAP を実行している 8.3.1 以前
+
この場合、次の構成は構成の適用（カットオーバー前）フェーズでは適用されず、カットオーバーフェーズで適用されます。

+
** SAN 構成
** Snapshot スケジュールの設定


* SnapLock Compliance ボリューム
+
プロジェクトに SnapLock Compliance ボリュームが含まれている場合は、 Snapshot スケジュールの設定は構成の適用（カットオーバー前）フェーズでは適用されません。カットオーバーフェーズで適用されます。

+
xref:concept_considerations_for_transitioning_of_snaplock_compliance_volumes.adoc[SnapLock Compliance ボリュームの移行に関する考慮事項]。



ターゲットクラスタが Data ONTAP 8.3.1 以前を実行していて、 NAS ボリュームに対して読み取り / 書き込みモードで構成の適用（カットオーバー前）処理を実行する場合は、 NAS ボリュームと SAN ボリュームで別々のプロジェクトを作成する必要があります。これは、構成の適用（カットオーバー前）読み取り / 書き込みモードはプロジェクトに SAN ボリュームがあるとサポートされないためです。

プロジェクトに SnapLock Compliance ボリュームが含まれている場合に、非 SnapLock Compliance ボリュームに対して読み取り / 書き込みモードで構成の適用（カットオーバー前）処理を実行するには、 SnapLock Compliance ボリュームと非 SnapLock Compliance ボリュームで別々のプロジェクトを作成する必要があります。これは、構成の適用（カットオーバー前）読み取り / 書き込みモードはプロジェクトに SnapLock Compliance ボリュームがあるとサポートされないためです。

カットオーバー前読み取り専用モード * では、ツールによって次の手順が実行されます。

. 7-Mode ボリュームから ONTAP ボリュームに差分更新を実行します
. 7-Mode ボリュームと ONTAP ボリューム間の SnapMirror 関係を解除します
+

NOTE: SnapLock Compliance ボリュームの場合、 7-Mode ボリュームと ONTAP ボリュームの間の SnapMirror 関係は解除されません。これは、 7-Mode ボリュームと ONTAP ボリューム間の SnapMirror 再同期処理が SnapLock Compliance ボリュームではサポートされないためです。

. 7-Mode ボリュームの構成を収集し、に適用します ONTAP ボリュームと SVM
. SVM にデータ LIF を設定します。
+
** 管理ステータスが down になっている SVM では、既存の 7-Mode IP アドレスが作成されます。
** 管理ステータスが up になっている SVM では、新しい IP アドレスが作成されます。


. 7-Mode ボリュームと ONTAP ボリューム間の SnapMirror 関係を再同期します


カットオーバー前読み取り / 書き込みモード * では、次の手順が実行されます。

. 7-Mode ボリュームから ONTAP ボリュームに差分更新を実行します
. 7-Mode ボリュームと ONTAP ボリューム間の SnapMirror 関係を解除します
. 7-Mode ボリュームの構成を収集し、に適用します ONTAP ボリュームと SVM
. SVM にデータ LIF を設定します。
+
** 管理ステータスが down になっている SVM では、既存の 7-Mode IP アドレスが作成されます。
** 管理ステータスが up になっている SVM では、新しい IP アドレスが作成されます。


. 実行中に、 ONTAP ボリュームでデータの読み取り / 書き込みアクセスをテストします 構成の適用（カットオーバー前）テスト
+
これらの ONTAP ボリュームは、構成の適用後に読み取り / 書き込み可能になります。構成の適用後に、 ONTAP ボリュームに対する読み取りと書き込みが可能になるため、構成の適用（カットオーバー前）のテスト時にはこれらのボリュームでデータの読み取り / 書き込みアクセスをテストできます。

. 手動： ONTAP で構成とデータアクセスを検証
. 手動：テストを終了します
+
ONTAP ボリュームが再同期されます。





== ストレージカットオーバー（セカンダリボリューム）フェーズ

次の図は、セカンダリボリュームの移行を表しています。

image::../media/transition_secondary.gif[セカンダリを移行する]

|===
| フェーズ | 手順 


 a| 
ストレージカットオーバー（セカンダリボリューム）
 a| 
. セカンダリボリュームを移行する
. セカンダリボリューム間の SnapMirror 関係を解除して削除します
. 7-Mode プライマリと ONTAP 間に DR 関係を確立する セカンダリボリューム


|===
7-Mode Transition Tool がこのフェーズで実行するタスクは次のとおりです。

. オプション： ONTAP セカンダリボリュームに対して SnapMirror 更新をオンデマンドで実行します
. 手動：必要に応じてクライアントアクセスを切断します
. 7-Mode セカンダリボリュームからの最終 SnapMirror 更新を実行します を選択します ONTAP
. 7-Mode セカンダリボリュームと ONTAP セカンダリボリューム間の SnapMirror 関係を解除および削除して、デスティネーションボリュームを読み取り / 書き込み可能にします
. ターゲットクラスタで Data ONTAP 8.3.0 または 8.3.1 が実行されていて、プロジェクトに SAN ボリュームが含まれている場合は、 Snapshot スケジュールの設定を適用します
. ターゲットクラスタで Data ONTAP 8.3.1 以前が実行されている場合、 SAN 構成を適用します
+

NOTE: この処理で、必要な igroup がすべて作成されます。セカンダリボリュームでは、カットオーバー処理の実行中に LUN が igroup にマッピングされません。プライマリボリュームのストレージカットオーバー処理が完了したあとに、セカンダリ LUN を手動でマッピングする必要があります。ただし、セカンダリプロジェクトに含まれるスタンドアロンボリュームの場合は、この処理の実行中に LUN が igroup にマッピングされます。

. クォータ構成があれば適用します
. 7-Mode 上のボリューム間に SnapMirror 関係を確立します プライマリシステムと ONTAP セカンダリボリューム
+
7-Mode プライマリボリュームと 7-Mode セカンダリボリュームの間の SnapMirror 関係を更新するための SnapMirror スケジュールが、 7-Mode プライマリボリュームと ONTAP セカンダリボリュームの間の SnapMirror 関係に適用されます。

. 移行対象として選択した既存の 7-Mode IP アドレスを削除します 7-Mode システムを移行し、にデータ LIF を配置する SVM の管理状態が up になります
+

NOTE: SAN LIF は 7-Mode Transition Tool では移行されません。

. オプション： 7-Mode ボリュームをオフラインにします




== ストレージカットオーバー（プライマリボリューム）フェーズ

次の図は、プライマリボリュームの移行を表しています。

image::../media/transition_primary.gif[移行優先]

|===
| フェーズ | 手順 


 a| 
ストレージカットオーバー（プライマリボリューム）
 a| 
. プライマリボリュームを移行する
. 7-Mode システムからクライアントを切断する（ストレージカットオーバー）
. 7-Mode プライマリ間の DR 関係を解除して削除します および ONTAP セカンダリボリュームに保存できます
. プライマリボリューム間の SnapMirror 関係を解除して削除します
. ONTAP プライマリ間に SVM ピア関係を設定します してください
. ONTAP ボリューム間の SnapMirror 関係を再同期します
. ONTAP ボリュームへのクライアントアクセスを有効にする


|===
7-Mode Transition Tool がこのフェーズで実行するタスクは次のとおりです。

. オプション： ONTAP セカンダリボリュームに対して SnapMirror 更新をオンデマンドで実行します
. 手動：クライアントアクセスを 7-Mode システムから切断します
. 7-Mode プライマリボリュームから最後の差分更新を実行します と ONTAP プライマリボリュームです
. 7-Mode プライマリボリュームと ONTAP プライマリボリューム間の SnapMirror 関係を解除および削除して、デスティネーションボリュームを読み取り / 書き込み可能にします
. ターゲットクラスタがの場合、 Snapshot スケジュールの設定を適用します Data ONTAP 8.3.0 または 8.3.1 を実行しており、プロジェクトにが含まれている SAN ボリューム
. ターゲットクラスタで Data ONTAP 8.3.1 以前が実行されている場合、 SAN 構成を適用します
. クォータ構成があれば適用します
. 7-Mode プライマリ間の SnapMirror 関係を解除して削除します ボリュームと ONTAP セカンダリボリューム
. 間にクラスタピア関係と SVM ピア関係を設定 プライマリクラスタとセカンダリクラスタ
. プライマリとセカンダリの間に SnapMirror 関係を設定します ONTAP ボリューム
. ONTAP ボリューム間の SnapMirror 関係を再同期します
. 移行対象として選択した既存の 7-Mode IP アドレスを削除します 7-Mode システムを移行し、にデータ LIF を配置する プライマリ SVM の管理状態が up になります
+

NOTE: SAN LIF は 7-Mode Transition Tool では移行されません。

. オプション： 7-Mode ボリュームをオフラインにします




== SnapLock ボリュームに対する CoC 検証プロセス

CoC 検証処理を実行します。

. 7-Mode ボリュームの WORM ファイルをすべて列挙します
. 列挙した各 WORM ファイルについて、 7-Mode ボリュームと移行した ONTAP ボリュームの両方でフィンガープリントを計算します。
. フィンガープリントが一致するファイルと一致しないファイルの数、および不一致の理由を記載したレポートを作成します


[NOTE]
====
* CoC 検証処理は、名前に ASCII 文字のみを含むファイルが格納されている読み書き可能な SnapLock ボリュームでのみサポートされます。
* 7-Mode SnapLock ボリュームのファイル数によっては、この処理にはかなりの時間がかかることがあります。


====


== 移行後の手順

カットオーバーフェーズが正常に終了して移行が完了したら、次に示す移行後のタスクを実行する必要があります。

. 7-Mode システムで提供されていた機能のうち、ツールで自動的に SVM に移行されなかった機能を移行する手順を手動で実行します。
. ターゲットクラスタで Data ONTAP 8.3.1 以前が実行されている場合は、セカンダリ LUN を手動でマッピングする必要があります。
. SAN を移行する場合は、ホストを手動で再設定します。
+
http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-7mtt-sanspl/home.html["SAN ホストの移行および修復"]

. 次の点を検証し、 SVM がクライアントにデータを提供できる状態であることを確認します。
+
** SVM 上のボリュームがオンラインであり、読み取り / 書き込み可能である。
** 移行した IP アドレスが SVM 上で有効になっており、到達可能である。


. クライアントアクセスを ONTAP ボリュームにリダイレクトします。


* 関連情報 *

xref:task_transitioning_volumes_using_7mtt.adoc[7-Mode ボリュームからデータと構成をマイグレート]
