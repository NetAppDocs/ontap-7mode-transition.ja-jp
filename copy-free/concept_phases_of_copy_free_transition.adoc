---
permalink: copy-free/concept_phases_of_copy_free_transition.html 
sidebar: sidebar 
keywords: ontap, transition, copy, free, phases 
summary: 7-Mode Transition Tool を使用したコピーフリーの移行は、計画、 SVM のプロビジョニング、エクスポートおよび停止、ケーブル接続、インポート、 テスト、運用の開始、コミット移行を効果的に管理するには、これらのフェーズについて理解する必要があります。 
---
= コピーフリーの移行のフェーズ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
7-Mode Transition Tool を使用したコピーフリーの移行は、計画、 SVM のプロビジョニング、エクスポートおよび停止、ケーブル接続、インポート、 テスト、運用の開始、コミット移行を効果的に管理するには、これらのフェーズについて理解する必要があります。

コピーフリーの移行はシステムの停止を伴う処理です。そのため、 7-Mode ストレージシステムで実行するアプリケーションとワークロードのダウンタイムについて計画する必要があります。

ほとんどの場合、ストレージカットオーバーの所要時間は 3~8 時間です。カットオーバー時間には、エクスポートおよび停止処理とインポート処理の 2 つの自動処理をツールで実行するためにかかる時間と、ディスクシェルフを新しいコントローラに手動でケーブル接続するためにかかる時間が含まれます。エクスポートおよび停止処理とインポート処理の合計所要時間は、最大で 2 時間程度です。


NOTE: 拡張構成の場合は、エクスポートおよび停止処理とインポート処理の合計所要時間が 2 時間を超えることがあります。7-Mode Transition Tool では、このような状況が検出されて警告が表示されます。

ディスクシェルフのケーブル接続には 1 時間から 6 時間かかる場合があります。カットオーバー時間の目安には必要なテストの時間が含まれておらず、移行中にディスク障害などの予期しない障害が発生しないことを前提としています。

image::../media/cft_phases.gif[コピーフリーの移行のフェーズ]



== プロジェクトの計画

Copy-Free Transition プロジェクトでは、ソースとターゲットに関する以下の詳細を計画できます。

* 7-Mode HA ペアと vFiler ユニットの詳細
* ターゲットクラスタノードとソースコントローラからターゲットへのマッピング ノード
* 7-Mode コントローラまたは vFiler ユニットから SVM へのマッピング
* 移行する IP アドレス （新しい LIF または既存の 7-Mode IP アドレス） SVM の IPspace とブロードキャストドメインも含まれます
+

NOTE: 7-Mode Transition Tool では、 FC LIF と iSCSI LIF の移行はサポートされていません。これらの LIF は、移行前に手動で SVM に設定する必要があります。



このフェーズでは、事前確認が実行されて、 7-Mode HA ペアを clustered Data ONTAP にマイグレートする準備ができているかどうかが検証されます。また、クラスタが正しく構成されていて、移行が可能な状態かどうかも検証されます。

移行を続行する前に、すべてのエラーを解決する必要があります。警告を解決しなくても移行は続行できますが、続行する前に警告をすべて解決しておくことを推奨します。事前確認を複数回実行して、すべてのエラーが解決されたことを確認することができます。



== SVM のプロビジョニング

移行プロジェクトを計画したら、ライセンスの追加、 CIFS サーバの作成、 SAN LIF の作成、クラスタと SVM で移行の準備などのいくつかのタスクを手動で実行する必要があります。

その後、ツールを使用して SVM に構成を適用します。7-Mode コントローラまたは vFiler ユニットレベルの構成は、すべてマッピングした SVM に移行されます。ボリュームと LUN の構成は、このフェーズでは移行されず、インポートフェーズで移行されます。

このフェーズの最後に、 SVM に適用された構成を手動で検証し、必要な変更を加えます。



== ストレージ構成をエクスポートして 7-Mode システムを停止します

このフェーズは、 Copy-Free Transition のカットオーバー期間の最初のフェーズです。クライアントアクセスを手動で切断する必要があります。ただし、すべての NAS サービスと SAN サービスが 7-Mode HA ペアで稼働している必要があります。これは、 7-Mode Transition Tool で 7-Mode システムからボリュームレベルの構成を収集するためには、すべてのサービスが稼働している必要があるためです。

エクスポートフェーズでは、ツールは次の処理を実行します。

* ボリュームとストレージの構成をすべて収集します
* 移行する各アグリゲートの Snapshot コピーを作成します
+
必要に応じて、この Snapshot コピーを使用して 7-Mode にロールバックします。

* 7-Mode コントローラをメンテナンスモードでブートします
* 7-Mode に接続されたディスクからディスク所有権を削除します コントローラ
* ターゲットクラスタノードでディスクの自動割り当てを無効にします




== 7-Mode ディスクシェルフのケーブル接続

このフェーズのタスクは手動で実行する必要があります。7-Mode コントローラとターゲットクラスタノードで一意のディスクシェルフ ID を使用してください。


NOTE: ディスクシェルフ ID が重複している場合は、 ID を変更してから、ディスクシェルフの電源を再投入する必要があります。

すべての 7-Mode ディスクシェルフを切断して、ターゲットクラスタノードにホットアドする必要があります。ディスクシェルフをターゲットクラスタノードに接続したら、ディスクシェルフの電源を再投入します。

Config Advisor を使用して、ケーブル接続を手動で検証することを推奨します。Config Advisor は、構成の検証や健常性のチェックに使用できるネットアップシステム向けのツールです。データ収集とシステム分析のために、セキュアなサイトにもセキュアでないサイトにも導入できます。

その後、 7-Mode Transition Tool を使用してケーブル接続を検証し、移行を続行できます。7-Mode Transition Tool で実行されるケーブル接続チェックは、 Config Advisor で実行されるチェックのうちの一部です。



== 7-Mode のデータと構成をインポート

このフェーズでは、すべてのストレージオブジェクト（アグリゲート、ボリューム、および LUN ）と関連する構成が移行されます。

インポートフェーズでは、ツールは次の処理を実行します。

* 7-Mode のディスクがマッピングしたターゲットクラスタノードに割り当てられます。
* 7-Mode のアグリゲート、ボリューム、および LUN がすべて、 clustered Data ONTAP 形式に変換されます。
* LIF が管理状態が up で SVM に設定されます。
* ボリュームレベルおよび LUN レベルの構成がすべて適用されます。




== テスト

このフェーズでは、ターゲット SVM に適用される、移行したすべてのアグリゲート、ボリューム、および構成を手動でテストする必要があります。また、ホストの設定や SAN ホストの修正など、構成を完了するための手動タスクもすべて実行する必要があります。

移行したアグリゲートやボリュームに対して、このフェーズ中に特定の処理を実行することはできません。また、テストフェーズでは推奨されない処理もあります。これは、 7-Mode へのロールバックが必要となった場合に、ロールバック処理が成功するようにするための措置です。

また、本番環境でのデータアクセスを開始する前に、すべてのアプリケーションとワークロードを手動で入念にテストする必要があります。


IMPORTANT: テスト時に実行されるアグリゲート Snapshot コピーおよび書き込み処理が原因で、アグリゲートのスペースが不足する可能性があります。物理的な空きスペースが合計スペースの 5% 未満になると、アグリゲートはオフラインになります。移行したアグリゲート内の使用可能な空き物理スペースを定期的に監視して、スペース不足を回避する必要があります。



== 運用を開始しています

すべてのワークロードとアプリケーションのテストが完了したら、移行したデータへのクライアントアクセスを本番環境で開始できます。この移行ステージは、本番環境の運用が開始されているものの、プロジェクトのコミットがまだ済んでいない場合を対象としています。このフェーズは、 7-Mode へのロールバックを決断した場合の移行の最終フェーズです。次の理由により、このフェーズを延長することはできません。

* 新しいデータがボリュームに書き込まれると、移行したアグリゲートのスペースが不足する可能性が高くなる。
* このフェーズでボリュームに書き込まれた新しいデータはロールバック後に使用できなくなります。




== プロジェクトをコミットしています

移行の最終フェーズです。エクスポートフェーズで作成されたアグリゲートレベルの Snapshot コピーが削除されます。

7-Mode アグリゲートをコミットして移行を完了したあとで、 7-Mode にロールバックすることはできません。

* 関連情報 *

https://mysupport.netapp.com/site/tools/tool-eula/activeiq-configadvisor["ネットアップのダウンロード： Config Advisor"]
